(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{541:function(s,t,n){"use strict";n.r(t);var a=n(4),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("redis单机版数据迁移。")]),s._v(" "),n("p",[s._v("从一个实例迁移到另一个实例，使用于本机不同端口迁移备份、其他机器间迁移备份。")]),s._v(" "),n("p",[s._v("工具是一个简单的python脚本，指定redis的源和目标信息即可。")]),s._v(" "),n("p",[s._v("脚本链接："),n("a",{attrs:{href:"https://github.com/staugur/scripts/blob/master/services/migrateredis.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/staugur/scripts/blob/master/services/migrateredis.py"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("其内容直接贴在下面：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    migrateredis.py\n    ---------------\n\n    迁移redis数据，可以从本机迁移到其他机器，迁移一个库或多个库中数据。\n\n    原理：redis dump/restore命令\n\n    依赖：pip install redis>=2.10.5\n"""')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" redis "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" from_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" RedisError\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("migrate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("src_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dst_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    src "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" from_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("src_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    dst "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" from_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dst_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" src"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            dst"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restore"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" src"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ttl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" src"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dump"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" RedisError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Migrate %s failed'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 源redis的url，格式：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redis://[:password]@host:port/db")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#host,port必填项,如有密码,记得密码前加冒号,比如redis://localhost:6379/0")]),s._v("\n    src_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis://@127.0.0.1:6379/0"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 迁移目标redis的url")]),s._v("\n    dst_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis://@127.0.0.1:16379/0"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" src_url "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" dst_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        migrate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("src_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dst_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("p",[n("strong",[s._v("注意：")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("使用时先安装依赖模块，命令是：pip install redis>=2.10.5\n\n再修改src\\_url和dst\\_url，参见注释，然后用python执行此脚本。\n")])])]),n("p",[s._v("FAQ:")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("1. pip install时提示not found command\n\n    答：CentOS系统使用yum install \\-y python-pip安装，Ubuntu使用apt-get install python-pip")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);