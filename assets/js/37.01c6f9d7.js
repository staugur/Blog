(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{334:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("请转到"),s("a",{attrs:{href:"https://blog.saintic.com/blog/264.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.saintic.com/blog/264.html"),s("OutboundLink")],1),t._v("查看服务器命令审计。")])]),t._v(" "),s("p",[t._v("linux命令审计功能，CentOS7下测试，记录所有用户的命令操作。")]),t._v(" "),s("p",[t._v("1. 准备")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("touch /var/log/myaudit.log\nchmod a+w /var/log/myaudit.log\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("2. 根据变量写日志")]),t._v(" "),s("p",[t._v("修改/etc/profile，追加以下代码，重新登录生效。")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('HISTTIMEFORMAT="%Y/%m/%d %T  "\nHISTORY_FILE=/var/log/myaudit.log\nreadonly PROMPT_COMMAND=\'{ date "+%y-%m-%d %T ##### $(who am i |awk "{print \\$1\\" \\"\\$2\\" \\"\\$5}") #### $(pwd) #### $(history 1 | { read x cmd; echo "$cmd"; })"; } >> $HISTORY_FILE\'\nexport HISTTIMEFORMAT HISTORY_FILE PROMPT_COMMAND\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("效果如下图，")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.saintic.com/EauDouce/blog/201708201816342539.png",alt:"QQ截图20170820181608"}})]),t._v(" "),s("Ads")],1)}),[],!1,null,null,null);a.default=n.exports}}]);